version: "3.9"

services:
  server:
    build:
      context: ./server
    environment:
      - HOME_DIRECTORY=${HOME_DIRECTORY:-/}
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
      - AZURE_TENANT_ID=${AZURE_TENANT_ID}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
      - AZURE_REDIRECT_URI=${AZURE_REDIRECT_URI}
      - AZURE_ALLOWED_AUDIENCE=${AZURE_ALLOWED_AUDIENCE}
      - AZURE_JWKS_TTL=${AZURE_JWKS_TTL:-300}
      - APP_LOG_LEVEL=${APP_LOG_LEVEL:-INFO}
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-dev-secret-key}
    ports:
      - "5000:5000"
  client:
    build:
      context: ./client
      args:
        HOME_DIRECTORY: ${HOME_DIRECTORY:-/}
    depends_on:
      - server
    ports:
      - "8084:80"
    environment:
      - HOME_DIRECTORY=${HOME_DIRECTORY:-/}
